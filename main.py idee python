import webview

auth = AuthService()

class Api:
    # Auth
    def register_user(self, username, password):
        return auth.register_user(username, password)

    def login(self, username, password):
        return auth.login(username, password)

    def logout(self, token):
        return auth.logout(token)

    def me(self, token):
        return auth.me(token)

    def check_password_strength(self, password):
        return auth.check_password_strength(password)

    def check_password_compromised(self, password):
        return auth.check_password_compromised(password)

# Lancement de l’appli
if __name__ == "__main__":
    window = webview.create_window("Gestion de Produits Sécurisée", "index.html")
    webview.start(gui="cef", func=None, debug=False, http_server=False, js_api=Api())
// Login
async function onLogin() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  const res = await window.pywebview.api.login(username, password);
  if (res.ok) {
    localStorage.setItem('session_token', res.token);
    // afficher UI authentifiée
  } else {
    alert(res.error || 'Erreur de connexion');
  }
}

// Vérifier session
async function loadMe() {
  const token = localStorage.getItem('session_token');
  if (!token) return;
  const res = await window.pywebview.api.me(token);
  if (!res.ok) {
    localStorage.removeItem('session_token');
  }
}

// Logout
async function onLogout() {
  const token = localStorage.getItem('session_token');
  if (token) {
    await window.pywebview.api.logout(token);
  }
  localStorage.removeItem('session_token');
}
